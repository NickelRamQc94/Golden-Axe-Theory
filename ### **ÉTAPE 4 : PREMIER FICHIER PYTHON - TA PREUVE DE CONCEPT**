```python
# Nom du fichier: tools/pi_n_calculator.py
"""
Î _N Calculator - Core tool of Golden-Axe Theory
"""

import numpy as np
from scipy import stats

class PiNCalculator:
    """
    Calculate Î _N for any system.
    
    Î _N = C Ã— (ATI/TCF)^Î±
    
    Where:
    - ATI: Anisotropy Turbulence Index
    - TCF: Turbulent Correlation Factor
    - Î±: Scaling exponent (â‰ˆ0.75)
    - C: System-specific constant
    """
    
    def __init__(self, alpha=0.75):
        self.alpha = alpha
        self.calibration_data = []
        
    def calculate_from_timeseries(self, timeseries):
        """
        Calculate Î _N from raw time series data.
        
        Args:
            timeseries: Array-like time series data
            
        Returns:
            pi_n: Calculated Î _N value
            confidence: Confidence interval (95%)
        """
        # Convert to numpy array
        data = np.array(timeseries)
        
        # Calculate basic statistics
        mean_val = np.mean(data)
        std_val = np.std(data)
        skew_val = stats.skew(data)
        kurt_val = stats.kurtosis(data)
        
        # Calculate ATI (Anisotropy Turbulence Index)
        # Based on non-Gaussianity and intermittency
        ati = std_val / (mean_val + 1e-10) * (1 + abs(skew_val))
        
        # Calculate TCF (Turbulent Correlation Factor)
        # Based on autocorrelation decay
        autocorr = np.correlate(data - mean_val, data - mean_val, mode='full')
        autocorr = autocorr[len(autocorr)//2:]
        decay_time = np.argmax(autocorr < 0.5)  # Time to decay to 50%
        tcf = 1 / (decay_time + 1e-10)
        
        # Calculate Î _N
        ratio = ati / tcf if tcf != 0 else ati
        pi_n = 0.8 * (ratio ** self.alpha)
        
        # Calculate confidence (simplified)
        n = len(data)
        if n > 10:
            confidence = 1.96 * std_val / np.sqrt(n)
        else:
            confidence = 0.5 * pi_n  # Conservative estimate
            
        return {
            "Î _N": float(pi_n),
            "ATI": float(ati),
            "TCF": float(tcf),
            "confidence_95": float(confidence),
            "data_points": n,
            "status": "CRITICAL" if pi_n > 2.5 else "STABLE" if pi_n < 2.0 else "TRANSITION"
        }
    
    def calibrate(self, known_cases):
        """
        Calibrate the calculator with known cases.
        
        Args:
            known_cases: List of dicts with 'data' and 'true_pi_n'
        """
        for case in known_cases:
            result = self.calculate_from_timeseries(case['data'])
            error = abs(result['Î _N'] - case['true_pi_n'])
            self.calibration_data.append({
                'calculated': result['Î _N'],
                'actual': case['true_pi_n'],
                'error': error
            })
        
        # Calculate calibration metrics
        errors = [d['error'] for d in self.calibration_data]
        return {
            'calibration_samples': len(self.calibration_data),
            'mean_error': np.mean(errors),
            'max_error': np.max(errors),
            'calibrated': len(self.calibration_data) >= 5
        }

def quick_demo():
    """Run a quick demo of Î _N calculation."""
    print("ðŸš€ Golden-Axe Theory - Î _N Calculator Demo")
    print("=" * 50)
    
    # Generate example data (turbulent-like time series)
    np.random.seed(42)
    time = np.linspace(0, 100, 1000)
    
    # Create data with different turbulence levels
    stable_data = np.sin(0.1 * time) + 0.1 * np.random.randn(1000)
    turbulent_data = np.sin(0.1 * time) + 0.5 * np.random.randn(1000) + 0.3 * np.sin(0.5 * time)
    critical_data = np.sin(0.1 * time) + 1.0 * np.random.randn(1000) + 0.5 * np.sin(2 * time)
    
    calculator = PiNCalculator()
    
    cases = [
        ("Stable System", stable_data),
        ("Turbulent System", turbulent_data),
        ("Critical System", critical_data)
    ]
    
    for name, data in cases:
        result = calculator.calculate_from_timeseries(data)
        print(f"\nðŸ“Š {name}:")
        print(f"   Î _N = {result['Î _N']:.3f} Â± {result['confidence_95']:.3f}")
        print(f"   Status: {result['status']}")
        print(f"   ATI/TCF ratio: {result['ATI']/result['TCF']:.2f}")
    
    print("\n" + "=" * 50)
    print("âœ… Demo complete. Use in your own systems.")
    print("ðŸ“š Theory: Î _N > 2.5 indicates critical instability")
    
if __name__ == "__main__":
    quick_demo()
